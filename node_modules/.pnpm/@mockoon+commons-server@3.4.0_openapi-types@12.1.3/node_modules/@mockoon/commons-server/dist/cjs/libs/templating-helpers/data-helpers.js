"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DataHelpers = void 0;
const handlebars_1 = require("handlebars");
const object_path_1 = require("object-path");
const utils_1 = require("../utils");
const DataHelpers = function (processedDatabuckets) {
    const dataHelpers = {
        data: function (...args) {
            const parameters = args.slice(0, -1);
            if (parameters.length <= 0) {
                return;
            }
            const targetInfo = parameters[0];
            const targetDatabucket = processedDatabuckets.find((databucket) => databucket.id === targetInfo ||
                databucket.name.toLowerCase().includes(targetInfo.toLowerCase()));
            if (targetDatabucket === undefined) {
                return;
            }
            let value = targetDatabucket.value;
            if ((Array.isArray(targetDatabucket.value) ||
                typeof targetDatabucket.value === 'object') &&
                parameters.length > 1 &&
                typeof parameters[1] === 'string' &&
                parameters[1] !== '') {
                // path is provided and required
                let path = parameters[1];
                path = (0, utils_1.convertPathToArray)(path);
                // ensure a value was found at path
                const foundValue = (0, object_path_1.get)(value, path);
                value = foundValue !== undefined ? foundValue : '';
            }
            if (Array.isArray(value) || typeof value === 'object') {
                return new handlebars_1.SafeString(JSON.stringify(value));
            }
            else {
                return new handlebars_1.SafeString(value);
            }
        },
        dataRaw: function (...args) {
            const parameters = args.slice(0, -1);
            if (parameters.length <= 0) {
                return;
            }
            const targetInfo = parameters[0];
            const targetDatabucket = processedDatabuckets.find((databucket) => databucket.id === targetInfo ||
                databucket.name.toLowerCase().includes(targetInfo.toLowerCase()));
            if (targetDatabucket === undefined) {
                return;
            }
            let value = targetDatabucket.value;
            if ((Array.isArray(targetDatabucket.value) ||
                typeof targetDatabucket.value === 'object') &&
                parameters.length > 1 &&
                typeof parameters[1] === 'string' &&
                parameters[1] !== '') {
                // path is provided and required
                let path = parameters[1];
                path = (0, utils_1.convertPathToArray)(path);
                // ensure a value was found at path
                const foundValue = (0, object_path_1.get)(value, path);
                value = foundValue !== undefined ? foundValue : '';
                return value;
            }
            return value;
        }
    };
    return dataHelpers;
};
exports.DataHelpers = DataHelpers;
//# sourceMappingURL=data-helpers.js.map